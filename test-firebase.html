<!DOCTYPE html>
<html>
<head>
    <title>Teste Firebase - UNOBIX</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üî• Teste Firebase</h1>
    
    <button onclick="testFirebase()">Testar Firebase</button>
    <button onclick="testFirebaseConfig()">Testar Configura√ß√£o</button>
    <button onclick="testGoogleLogin()">Testar Login Google</button>
    
    <div id="log" class="log"></div>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCFUE9xXtbjJGQTz4nGgveWJx6DuhOqD2U",
            authDomain: "unobix-oauth-a69cd.firebaseapp.com",
            projectId: "unobix-oauth-a69cd",
            storageBucket: "unobix-oauth-a69cd.firebasestorage.app",
            messagingSenderId: "1067767347117",
            appId: "1:1067767347117:web:26e1193bdef8e264409324"
        };
        
        function log(msg, type = 'info') {
            const div = document.getElementById('log');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            div.appendChild(p);
            div.scrollTop = div.scrollHeight;
        }
        
        async function testFirebase() {
            log('1. Carregando Firebase SDK...', 'info');
            
            try {
                // Carregar Firebase
                await loadScript('https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js');
                log('‚úÖ Firebase App SDK carregado', 'success');
                
                await loadScript('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js');
                log('‚úÖ Firebase Auth SDK carregado', 'success');
                
                // Inicializar
                log('2. Inicializando Firebase...', 'info');
                firebase.initializeApp(firebaseConfig);
                log('‚úÖ Firebase inicializado', 'success');
                
                // Testar auth
                const auth = firebase.auth();
                log(`‚úÖ Auth dispon√≠vel: ${typeof auth}`, 'success');
                
                // Testar provider
                const provider = new firebase.auth.GoogleAuthProvider();
                log(`‚úÖ Google Provider dispon√≠vel: ${typeof provider}`, 'success');
                
                log('üéâ Firebase TESTADO COM SUCESSO!', 'success');
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
            }
        }
        
        async function testFirebaseConfig() {
            log('üîß Testando configura√ß√£o do Firebase...', 'info');
            
            // Verificar se dom√≠nio est√° autorizado
            const currentDomain = window.location.hostname;
            log(`Dom√≠nio atual: ${currentDomain}`, 'info');
            
            // Verificar se a configura√ß√£o parece v√°lida
            const requiredFields = ['apiKey', 'authDomain', 'projectId', 'appId'];
            const missing = requiredFields.filter(field => !firebaseConfig[field]);
            
            if (missing.length > 0) {
                log(`‚ùå Campos faltando: ${missing.join(', ')}`, 'error');
            } else {
                log('‚úÖ Configura√ß√£o b√°sica OK', 'success');
            }
            
            // Verificar authDomain
            if (firebaseConfig.authDomain.includes('firebaseapp.com')) {
                log('‚úÖ authDomain parece v√°lido', 'success');
            } else {
                log(`‚ö†Ô∏è authDomain incomum: ${firebaseConfig.authDomain}`, 'warning');
            }
        }
        
        async function testGoogleLogin() {
            log('üîê Testando login Google...', 'info');
            
            try {
                // Carregar Firebase se necess√°rio
                if (typeof firebase === 'undefined') {
                    await loadScript('https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js');
                    await loadScript('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js');
                    firebase.initializeApp(firebaseConfig);
                }
                
                const auth = firebase.auth();
                const provider = new firebase.auth.GoogleAuthProvider();
                
                log('Abrindo popup de login...', 'info');
                
                // Tentar popup
                try {
                    const result = await auth.signInWithPopup(provider);
                    log(`‚úÖ Login POPUP bem-sucedido! Usu√°rio: ${result.user.email}`, 'success');
                } catch (popupError) {
                    log(`‚ö†Ô∏è Popup falhou: ${popupError.code} - ${popupError.message}`, 'warning');
                    
                    // Tentar redirect
                    log('Tentando redirect...', 'info');
                    sessionStorage.setItem('testRedirect', 'true');
                    await auth.signInWithRedirect(provider);
                    log('‚úÖ Redirect iniciado (p√°gina deve recarregar)', 'info');
                }
                
            } catch (error) {
                log(`‚ùå Erro no login: ${error.code || ''} ${error.message}`, 'error');
                console.error('Erro detalhado:', error);
            }
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => reject(new Error(`Falha ao carregar: ${src}`));
                document.head.appendChild(script);
            });
        }
        
        // Verificar redirect result
        if (sessionStorage.getItem('testRedirect') === 'true') {
            log('üîÑ Verificando resultado de redirect...', 'info');
            sessionStorage.removeItem('testRedirect');
            
            setTimeout(async () => {
                if (typeof firebase !== 'undefined') {
                    try {
                        const result = await firebase.auth().getRedirectResult();
                        if (result.user) {
                            log(`‚úÖ Redirect bem-sucedido! Usu√°rio: ${result.user.email}`, 'success');
                        } else {
                            log('‚ÑπÔ∏è Nenhum resultado de redirect', 'info');
                        }
                    } catch (error) {
                        log(`‚ùå Erro no redirect: ${error.message}`, 'error');
                    }
                }
            }, 1000);
        }
    </script>
</body>
</html>